{% extends "detail.html" %}

{% block metadata %}
{% include "twitter_card.html" with title=work.title content=work.full_text %}
{% include "reference_metadata.html" with title=work.title authorships=authorships conference=work.conference id=work.id %}
{% endblock %}

{% block header_title %}"{{ work.title }}"{% endblock %}

{% block title %}{{ work.title }}{% endblock %}

{% block main %}
<div class="card my-2">
  <div class="card-header">
    Authorship
    {% if user.is_authenticated %}
    <a class="btn btn-primary" role="button" href="{% url 'work_edit_authorship' work.pk %}">Edit authorships</a>
    {% endif %}
  </div>
  <ol class="list-group list-group-flush">
    {% for authorship in authorships %}
    <li class="list-group-item">{% include "authorship_card.html" with authorship=authorship %}</li>
    {% endfor %}
  </ol>
</div>

{% if work.parent_session %}
<div class="card my-2">
  <div class="card-header">Parent session</div>
  <div class="card-body">
    <a href="{% url 'work_detail' work.parent_session.id %}">{{ work.parent_session.title }}<a>{% for author in work.parent_session.authorships.all %},
        {{ author.appellation.first_name }} {{ author.appellation.last_name }}{% endfor %}
  </div>
</div>
{% endif %}

{% if work.session_papers.exists %}
<div class=" card my-2">
  <div class="card-header">Children sessions</div>
  <ol class="list-group list-group-flush">
    {% for child in work.session_papers.all %}
    <li class="list-group-item">
      <a href="{% url 'work_detail' child.id %}">{{ child.title }}</a>{% for author in child.authorships.all %},
      {{ author.appellation.first_name }} {{ author.appellation.last_name }}{% endfor %}
    </li>
    {% endfor %}
  </ol>
</div>
{% endif %}

{% if work.url %}
<div class=" card my-2">
  <div class="card-header">Original URL</div>
  <div class="card-body">
    <a href="{{ work.url }}" target="_blank" rel="noopener noreferrer">{{ work.url }}</a>
  </div>
</div>
{% endif %}

{% if work.full_text %}
<div class="card my-2">
  <div class="card-header d-flex justify-content-between">Abstract</div>
  <div class="card-body">
    {% if user.is_authenticated or work.conference.full_text_public or work.full_text_license %}
    {% if work.full_text_type == "txt" %}
    <p>{{ work.full_text | linebreaks }}</p>
    {% elif work.full_text_type == "xml" %}
    {{ work.full_text | striptags | linebreaksbr }}
    {% endif %}
    {% else %}
    <div class="alert alert-warning">The full text for this abstract has been indexed, but we cannot display it here
      because it is protected by copyright. If you would like access to the full text, please {% if work.url %} use the
      URL above, or {% endif %} locate the conference proceedings through your institution's library.</div>
    {% endif %}
  </div>
  {% with license=work.full_text_license %}
  <div class="card-footer">
    {% if license %}
    <p>Full text license: {% if license.url %}<a href="{{ license.url }}">{% endif %}<abbr
          title="{{ license.title }}">{{ license.display_abbreviation }}</abbr>{% if license.url %}</a>{% endif %}</p>
    {% else %}
    <p>The license for this full text is unknown.</p>
    {% endif %}
    {% endwith %}
    {% if user.is_authenticated and work.full_text_type == "xml" %}
    <p><a href="{% url 'work_xml' work.id %}">Download raw XML</a></p>
    {% endif %}
  </div>
</div>
{% endif %}
{% endblock %}

{% block context %}
{% if user.is_authenticated %}
<div class="card my-2">
  <div class="card-header">Administration</div>
  <div class="card-body">
    <a class="btn btn-primary" role="button" href="{% url 'work_edit' work.pk %}">Edit this work</a>
    <a class="btn btn-danger" role="button" href="{% url 'work_delete' work.pk %}">Delete</a>
  </div>
</div>
{% endif %}
<div class="card my-2">
  <div class="card-header">Conference Info</div>
  <div class="card-body">
    {% include "conference_card.html" with conference=work.conference %}
  </div>
</div>

<div class="card my-2">
  <div class="card-header">Tags</div>
  <ul class="list-group list-group-flush">
    <li class="list-group-item">Keywords:
      {% if work.keywords.all %}
      {% for keyword in work.keywords.all %}
      <a class="badge badge-info" href="{% url 'work_list' %}?keyword={{ keyword.pk }}">{{ keyword.title }}</a>
      {% endfor %}
      {% else %}
      None
      {% endif %}
    </li>
    <li class="list-group-item">Language:
      {% if work.languages.all %}
      {% for language in work.languages.all %}
      <a class="badge badge-info" href="{% url 'work_list' %}?language={{ language.pk }}">{{ language.title }}</a>
      {% endfor %}
      {% else %}
      None
      {% endif %}
    </li>
    <li class="list-group-item">Topics:
      {% if work.topics.all %}
      {% for topic in work.topics.all %}
      <a class="badge badge-info" href="{% url 'work_list' %}?topic={{ topic.pk }}">{{ topic.title }}</a>
      {% endfor %}
      {% else %}
      None
      {% endif %}
    </li>
    <li class="list-group-item">Disciplines:
      {% if work.disciplines.all %}
      {% for discipline in work.disciplines.all %}
      <a class="badge badge-info" href="{% url 'work_list' %}?discipline={{ discipline.pk }}">{{ discipline.title }}</a>
      {% endfor %}
      {% else %}
      None
      {% endif %}
    </li>
  </ul>
</div>
{% endblock %}
